
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Pro tips for writing better rspec tests - Tech Blog</title>
  <meta name="author" content="Aleksandr Balakiriev">
  <link rel="author" href="humans.txt">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  
    
  
  <meta name="description" content="Writing ‘good code’ is always a challenge for every project. Unfortunately, we always associate it with development and not tests. What about &hellip;">
  
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.balakiriev.com/blog/2013/12/30/pro-tips-for-writing-better-rspec-tests/">
  <link href="/images/favicon.ico" rel="icon">
  <link href='http://fonts.googleapis.com/css?family=Cantarell' rel='stylesheet' type='text/css'>
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Tech Blog" type="application/atom+xml">
  <meta name="og:type" content="website" />
  <meta name="og:site_name" content="Tech Blog" />
  <meta name="og:title" content="Pro tips for writing better rspec tests" />
  <meta name="og:description" content="Writing ‘good code’ is always a challenge for every project. Unfortunately, we always associate it with development and not tests. What about &hellip;" />
  <meta name="og:url" content="http://blog.balakiriev.com/blog/2013/12/30/pro-tips-for-writing-better-rspec-tests/"/>
  <meta name="url" content="http://blog.balakiriev.com/blog/2013/12/30/pro-tips-for-writing-better-rspec-tests/">
  
  <meta name="subject" content="rspec"/>
  <meta name="category" content="rspec"/>
  
  <meta name="distribution" content="global">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-47232723-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <nav role="navigation"><div class="navbar">
  <div class="navbar-inner">
    <a class="brand" href="/">Tech Blog</a>
    <ul class="nav">
      <li><a href="/blog/archives">All Blogs</a></li>
      
    </ul>
    <ul class="nav" data-subscription="rss">
      <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
      
    </ul>
      
    <form class="navbar-form" action="http://google.com/search" method="get">
      <fieldset role="search">
        <input type="hidden" name="q" value="site:blog.balakiriev.com" />
        <input class="span2" type="text" name="q" results="0" placeholder="Search"/>
      </fieldset>
    </form>
      
    
  </div>
</div>
</nav>
  <div class="wrapper_single">
    <div class="container">
      <article class="span8 offset2" role="article">
        <div class="article-format">

  <header>
    
      <h1 class="entry-title">Pro Tips for Writing Better Rspec Tests</h1>
    
    
      <p class="meta">
        
  


  
    <span class="byline author vcard">by <span class="fn">Aleksandr Balakiriev</span></span>
  

 - 
        








  


<time datetime="2013-12-30T15:42:00+01:00" pubdate data-updated="true">Dec 30<span>th</span>, 2013</time> - 
        

posted in
<span class="categories">
  
    <a class='category' href='/blog/categories/rspec/'>rspec</a>
  
</span>


        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Writing ‘good code’ is always a challenge for every project. Unfortunately, we always associate it with development and not tests. What about automation test code? Ever notice that you have write more automation code than the actual lines of development code?</p>

<p>Improper automation code leads to slow running specs, huge LOC in your spec files and a whole lot of confusion when you open a spec file. So, how does one avoid these problems?</p>

<p>Here are a few guidelines:</p>

<p>Tip #1: Follow
<a title="Rspec-style" href="https://github.com/howaboutwe/rspec-style-guide">Rspec style</a></p>

<p>Tip #2: Independent tests</p>

<p>We could use the word idempotent here but as a thumb rule there should not be any dependencies across specs and if we run the test multiple times in succession, it should give the same result So, it’s very important that every spec  run in clean database environment. Use <a href="https://github.com/bmabey/database_cleaner">database cleaner</a>  gem properly, so that you don’t end of having to seed the database before each test! So, if you don’t want roles and countries being deleted,</p>

<p>config.before(:suite) do
  DatabaseCleaner.strategy = :truncation, {:except => %w[roles countries]}
end</p>

<!--more -->


<p>Tip #3: Use expect and not should syntax</p>

<p>It’s just nice and clean!  Use the Transpec gem helps you to convert from should syntax to expect syntax</p>

<p>expect(User.all.count).to eq(1)
instead of</p>

<p>User.all.count.should == 1</p>

<p>Tip#4: Use the new syntax for object creation</p>

<p>Use the new FactoryGirl syntax that is supported in factory_girl4. This helps the code be clean of any harsh gem dependent syntax of class names!</p>

<p>create(:user)
instead of</p>

<p>FactoryGirl.create(:user)</p>

<p>Tip #5: Use let variables instead of instance variables</p>

<p>This makes code look cleaner. For better understanding about let read the answer given by Myron. Here is an example</p>

<p>describe Project do
  let(:project) { build(:project) }</p>

<p>  it &ldquo;project should be valid&rdquo; do</p>

<pre><code>expect(project.valid?).to eq(true)
</code></pre>

<p>  end
end
Now, when the example executes it defines a method called project if its not defined already or simply returns the value. Fast and efficient.</p>

<p>Tip #6: Use correct expectations for a spec</p>

<p>Obvious as it seems – the test we write should test the write stuff – not just make the test pass! Here is an example of making a test case pass.</p>

<p>context &ldquo;#edit&rdquo; do
  it &ldquo;user should be able to edit his profile&rdquo; do</p>

<pre><code>get :edit, id: user.id
expect(response).to be_success
</code></pre>

<p>  end
end
So, your expectation should ideally be</p>

<p>describe UsersController do
  context &ldquo;#edit&rdquo; do</p>

<pre><code>#render_views
it "user should be able to edit his profile" do
  get :edit, id: user.id
  expect(response).to render_template("edit")
end
</code></pre>

<p>  end
end
Here #edit is a method defined in UsersController. So I defined a context in my specs.</p>

<p>Do remember that by default all controller specs stub the template rendering unless and until you include render_views</p>

<p>Tip #7: Use shared examples.</p>

<p>When you want to test the same functionality across different subjects, for example different kinds of users, use shared examples.</p>

<p>context &ldquo;#edit&rdquo; do
  it &ldquo;admin should be able to edit his profile&rdquo;
  it &ldquo;distributor should be able to edit his profile&rdquo;
end
You can write as</p>

<p>context &ldquo;#edit&rdquo; do
  shared_examples &ldquo;profile_editing&rdquo; do</p>

<pre><code>it "user should be able to edit his profile"
</code></pre>

<p>  end</p>

<p>  context &ldquo;admin&rdquo; do</p>

<pre><code>include_examples "profile_editing"
it "should be able see to list of distributors"
</code></pre>

<p>  end</p>

<p>  context &ldquo;distributor&rdquo; do</p>

<pre><code>include_examples "profile_editing"
it "should not able to see list of distributors"
</code></pre>

<p>  end
end
A word of caution – you may lost readability if you use too many shared examples in single file.</p>

<p>Tip #8: Use conditional hooks</p>

<p>Sometimes if you want to execute some piece of code only for one example but not for all examples in a context then you can use conditional hooks.</p>

<p>context &ldquo;#update&rdquo; do
  before(:each, run: true) do</p>

<pre><code># do something
</code></pre>

<p>  end</p>

<p>  it &ldquo;example1&rdquo;, run: :true
  it &ldquo;example2&rdquo;
end
Now before(:each) will run only for first example but not for second example.</p>

<p>Tip #9: Profiling your examples</p>

<p>rspec gives you an option to examine how much time does a example group take to run.  Simply run specs with the –profile flag.</p>

<p>rspec ./spec/models/user_spec.rb:51 &mdash;profile</p>

<h1>output:</h1>

<p>0.22431 seconds ./spec/models/user_spec.rb:51
Tip #10: Tagging</p>

<p>When you have a large test suite and you changed some code, how do you ensure that your change didn’t breaks existing functionality? One way is to run your specs locally then push then your Continuous Integration server that runs all specs. This is time consuming if you want to test only a specific set of tests.</p>

<p>Tag them! Run your module specified specs by using tags. For example, suppose we have a Commission feature and we written model specs, controller specs and integration specs for it. We can easily tag each file with commission:true.  So when we change something related to commissions,  we can run only commission related specs!. We can tag our scenarios as below</p>

<h1>spec/models/commission_spec.rb</h1>

<p>describe Commission, commission: true do
  # do something
end
rspec –tag commission
Note: We can tag entire context or a single example in the spec file. For more information please follow this link</p>

<p>All these tips are a results of practical problems I have faced and overcome and a result of finding out the best we can do our own testing. More suggestions and tips are welcome!</p>
</div>


  <footer>
    <p class="meta">
      
  


  
    <span class="byline author vcard">by <span class="fn">Aleksandr Balakiriev</span></span>
  


      








  


<time datetime="2013-12-30T15:42:00+01:00" pubdate data-updated="true">Dec 30<span>th</span>, 2013</time>
      

posted in
<span class="categories">
  
    <a class='category' href='/blog/categories/rspec/'>rspec</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://blog.balakiriev.com/blog/2013/12/30/pro-tips-for-writing-better-rspec-tests/" data-via="sbalakirev" data-counturl="http://blog.balakiriev.com/blog/2013/12/30/pro-tips-for-writing-better-rspec-tests/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    
      <a class="pull-left" href="/blog/2013/12/29/creation-of-remote-git-branch/" title="Previous Post: Creation of remote git branch">&laquo; Creation of remote git branch</a>
    
    
  </footer>

</div>

        
          <div class="article-format">
            <h1>Comments</h1>
            <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
          </div>
        
      </article>
    </div>
  </div>
  <div id="footer-widgets">
  <div class="container">
    <div class="row">
  <div class="span3">
    <h2>recent posts</h2>
    <ul class="recent_posts">
      
        <li>
          <a href="/blog/2013/12/30/pro-tips-for-writing-better-rspec-tests/">Pro tips for writing better rspec tests</a>
        </li>
      
        <li>
          <a href="/blog/2013/12/29/creation-of-remote-git-branch/">Creation of remote git branch</a>
        </li>
      
        <li>
          <a href="/blog/2013/12/29/globalize-your-gitignore/">Globalize your .gitignore</a>
        </li>
      
        <li>
          <a href="/blog/2013/12/29/creating-a-github-blog-using-octopress/">Creating a Github Blog Using Octopress</a>
        </li>
      
        <li>
          <a href="/blog/2013/10/05/show-generated-sql-in-rails-3-console/">Show generated SQL in Rails 3 console</a>
        </li>
      
    </ul>
    <h2><a href="/blog/archives">archives</a></h2>
  </div>
  <div class="span6">
    
<h2>recent public projects</h2>
<dl id="gh_repos" class="dl-horizontal" data-github-user="balakirevs" data-github-repo-count="5" data-github-skip-forks="true">
  <dd class="loading">Status updating...</dd>
</dl>
<script src="/javascripts/github.js" type="text/javascript"> </script>
<script src="/javascripts/libs/jXHR.js" type="text/javascript"> </script>


  </div>
  <div class="span3">
    
<h2>twitter</h2>
<a href="https://twitter.com/sbalakirev" class="twitter-follow-button" data-show-count="true" data-lang="en">Follow @sbalakirev</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<div class="tweet" data-twitter-user="sbalakirev">
</div>


  </div>
</div>

  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-left">
  <a href="">Tech Blog</a>
  - Copyright &copy; 2014 - <a href="http://balakiriev.com">Aleksandr Balakiriev</a>
</p>

  </div>
</footer>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script>window.jQuery || document.write('<script src="/javascripts/libs/jquery-1.7.2.min.js" type="text/javascript"><\/script>')</script>
<script src="/javascripts/libs/bootstrap.min.js" type="text/javascript"></script>
<script src="/javascripts/jquery.tweet.js" type="text/javascript"></script>
<script src="/javascripts/jquery.instagram.js" type="text/javascript"></script>
<script src="/javascripts/libs/jquery.masonry.min.js" type="text/javascript"></script>
<script src="/javascripts/custom.js" type="text/javascript"></script>


<script type="text/javascript">
      var disqus_shortname = 'balakirievme';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.balakiriev.com/blog/2013/12/30/pro-tips-for-writing-better-rspec-tests/';
        var disqus_url = 'http://blog.balakiriev.com/blog/2013/12/30/pro-tips-for-writing-better-rspec-tests/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
